{"logs": [], "results": [{"node": {"raw_sql": "--- \n--- get the source data from the GBFS web feeds\n---\n\nselect $1 data,\n    $2 url, citibike.utils.fetch_http_data($2) payload,\n    current_timestamp() row_inserted\nfrom (values\n    ('regions', 'https://gbfs.citibikenyc.com/gbfs/en/system_regions.json'),\n    ('stations', 'https://gbfs.citibikenyc.com/gbfs/en/station_information.json'),\n    ('neighborhoods', 'https://snowflake-demo-stuff.s3.amazonaws.com/neighborhoods.geojson'))", "compiled": true, "database": "citibike", "schema": "dbt_aeldridge", "fqn": ["citibike", "source", "gbfs_json"], "unique_id": "model.citibike.gbfs_json", "package_name": "citibike", "root_path": "/usr/src/develop/user-10267/environment-12627/repository-10327", "path": "source/gbfs_json.sql", "original_file_path": "models/source/gbfs_json.sql", "name": "gbfs_json", "resource_type": "model", "alias": "gbfs_json", "checksum": {"name": "sha256", "checksum": "ad0ea62c312670da7970e924a4e459b4d4ab757a2a9fb677331663768585e672"}, "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "alias": null, "schema": null, "database": "citibike", "tags": [], "full_refresh": null}, "tags": [], "refs": [], "sources": [], "depends_on": {"macros": ["macro.dbt_snowflake.set_query_tag", "macro.dbt.run_hooks", "macro.dbt.statement", "macro.dbt.persist_docs", "macro.dbt_snowflake.unset_query_tag"], "nodes": []}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/run/citibike/models/source/gbfs_json.sql", "deferred": false, "compiled_sql": "--- \n--- get the source data from the GBFS web feeds\n---\n\nselect $1 data,\n    $2 url, citibike.utils.fetch_http_data($2) payload,\n    current_timestamp() row_inserted\nfrom (values\n    ('regions', 'https://gbfs.citibikenyc.com/gbfs/en/system_regions.json'),\n    ('stations', 'https://gbfs.citibikenyc.com/gbfs/en/station_information.json'),\n    ('neighborhoods', 'https://snowflake-demo-stuff.s3.amazonaws.com/neighborhoods.geojson'))", "extra_ctes_injected": true, "extra_ctes": [], "injected_sql": "--- \n--- get the source data from the GBFS web feeds\n---\n\nselect $1 data,\n    $2 url, citibike.utils.fetch_http_data($2) payload,\n    current_timestamp() row_inserted\nfrom (values\n    ('regions', 'https://gbfs.citibikenyc.com/gbfs/en/system_regions.json'),\n    ('stations', 'https://gbfs.citibikenyc.com/gbfs/en/station_information.json'),\n    ('neighborhoods', 'https://snowflake-demo-stuff.s3.amazonaws.com/neighborhoods.geojson'))"}, "error": null, "status": "SUCCESS 1", "execution_time": 14.541261434555054, "thread_id": "Thread-1", "timing": [{"name": "compile", "started_at": "2020-10-20T03:27:36.753331Z", "completed_at": "2020-10-20T03:27:36.806518Z"}, {"name": "execute", "started_at": "2020-10-20T03:27:36.806888Z", "completed_at": "2020-10-20T03:27:50.819587Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "--- \n--- materialise the station records augmented with neighborhood data\n---\n\nwith s as (\n    select * from {{ ref('station_nhood_json') }}\n      where row_inserted = (select max(row_inserted) from {{ ref('station_json') }})),\nr as (\n    select * from {{ ref('region_json') }}\n      where row_inserted = (select max(row_inserted) from {{ ref('region_json') }}))\nselect station_v:station_id::number station_id,\n    station_v:name::string station_name,\n    station_v:lat::float station_lat,\n    station_v:lon::float station_lon,\n    station_geo,\n    station_v:station_type::string station_type,\n    station_v:capacity::number station_capacity,\n    station_v:rental_methods rental_methods,\n    region_v:name::string region_name,\n    borough_name, neighborhood_name\nfrom s left outer join r\n    on station_v:region_id::integer = region_v:region_id::integer", "compiled": true, "database": "citibike", "schema": "dbt_aeldridge", "fqn": ["citibike", "mart", "stations"], "unique_id": "model.citibike.stations", "package_name": "citibike", "root_path": "/usr/src/develop/user-10267/environment-12627/repository-10327", "path": "mart/stations.sql", "original_file_path": "models/mart/stations.sql", "name": "stations", "resource_type": "model", "alias": "stations", "checksum": {"name": "sha256", "checksum": "1f94ab637ad233832ef66bd91265285a892019ba99cac1a1389602ab34cda53a"}, "config": {"enabled": true, "materialized": "table", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "alias": null, "schema": null, "database": "citibike", "tags": [], "full_refresh": null}, "tags": [], "refs": [["station_nhood_json"], ["station_json"], ["region_json"], ["region_json"]], "sources": [], "depends_on": {"macros": ["macro.dbt_snowflake.set_query_tag", "macro.dbt.run_hooks", "macro.dbt.statement", "macro.dbt.persist_docs", "macro.dbt_snowflake.unset_query_tag"], "nodes": ["model.citibike.station_nhood_json", "model.citibike.station_json", "model.citibike.region_json", "model.citibike.region_json"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/run/citibike/models/mart/stations.sql", "deferred": false, "compiled_sql": "--- \n--- materialise the station records augmented with neighborhood data\n---\n\nwith s as (\n    select * from __dbt__CTE__station_nhood_json\n      where row_inserted = (select max(row_inserted) from __dbt__CTE__station_json)),\nr as (\n    select * from __dbt__CTE__region_json\n      where row_inserted = (select max(row_inserted) from __dbt__CTE__region_json))\nselect station_v:station_id::number station_id,\n    station_v:name::string station_name,\n    station_v:lat::float station_lat,\n    station_v:lon::float station_lon,\n    station_geo,\n    station_v:station_type::string station_type,\n    station_v:capacity::number station_capacity,\n    station_v:rental_methods rental_methods,\n    region_v:name::string region_name,\n    borough_name, neighborhood_name\nfrom s left outer join r\n    on station_v:region_id::integer = region_v:region_id::integer", "extra_ctes_injected": true, "extra_ctes": [{"id": "model.citibike.station_json", "sql": " __dbt__CTE__station_json as (\n\n\n--\n-- get the station data in JSON format\n--\n\nwith s as (\n    select payload, row_inserted from citibike.dbt_aeldridge.gbfs_json\n      where data = 'stations'\n      and row_inserted = (select max(row_inserted) from citibike.dbt_aeldridge.gbfs_json))\nselect value station_v,\n         payload:response.last_updated::timestamp last_updated,\n         row_inserted\nfrom s, lateral flatten (input => payload:response.data.stations)\n)"}, {"id": "model.citibike.nhood_json", "sql": " __dbt__CTE__nhood_json as (\n\n\n--\n-- get the neighborhood data in JSON format\n--\n\nwith n as (\n    select payload, row_inserted from citibike.dbt_aeldridge.gbfs_json\n      where data = 'neighborhoods'\n      and row_inserted = (select max(row_inserted) from citibike.dbt_aeldridge.gbfs_json))\nselect value neighborhood_v,\n    to_geography(value:geometry) geo,\n    value:properties.borough::string borough,\n    value:properties.neighborhood::string neighborhood\nfrom n, lateral flatten (input => payload:response.features)\n)"}, {"id": "model.citibike.station_nhood_json", "sql": " __dbt__CTE__station_nhood_json as (\n\n\n---\n--- augment the station records with the neighborhood they are in\n---\n\nselect station_v,\n    last_updated,\n    row_inserted,\n    st_point(station_v:lon::float, station_v:lat::float) station_geo,\n    borough borough_name,\n    neighborhood neighborhood_name\nfrom __dbt__CTE__station_json inner join __dbt__CTE__nhood_json\nwhere st_within(station_geo, geo)\n)"}, {"id": "model.citibike.region_json", "sql": " __dbt__CTE__region_json as (\n\n\n--\n-- get the region data in JSON format\n--\n\nwith r as (\n  select payload, row_inserted from citibike.dbt_aeldridge.gbfs_json\n      where data = 'regions'\n      and row_inserted = (select max(row_inserted) from citibike.dbt_aeldridge.gbfs_json))\nselect value region_v,\n         payload:response.last_updated::timestamp last_updated,\n         row_inserted\nfrom r, lateral flatten (input => payload:response.data.regions)\n)"}], "injected_sql": "--- \n--- materialise the station records augmented with neighborhood data\n---\n\nwith  __dbt__CTE__station_json as (\n\n\n--\n-- get the station data in JSON format\n--\n\nwith s as (\n    select payload, row_inserted from citibike.dbt_aeldridge.gbfs_json\n      where data = 'stations'\n      and row_inserted = (select max(row_inserted) from citibike.dbt_aeldridge.gbfs_json))\nselect value station_v,\n         payload:response.last_updated::timestamp last_updated,\n         row_inserted\nfrom s, lateral flatten (input => payload:response.data.stations)\n),  __dbt__CTE__nhood_json as (\n\n\n--\n-- get the neighborhood data in JSON format\n--\n\nwith n as (\n    select payload, row_inserted from citibike.dbt_aeldridge.gbfs_json\n      where data = 'neighborhoods'\n      and row_inserted = (select max(row_inserted) from citibike.dbt_aeldridge.gbfs_json))\nselect value neighborhood_v,\n    to_geography(value:geometry) geo,\n    value:properties.borough::string borough,\n    value:properties.neighborhood::string neighborhood\nfrom n, lateral flatten (input => payload:response.features)\n),  __dbt__CTE__station_nhood_json as (\n\n\n---\n--- augment the station records with the neighborhood they are in\n---\n\nselect station_v,\n    last_updated,\n    row_inserted,\n    st_point(station_v:lon::float, station_v:lat::float) station_geo,\n    borough borough_name,\n    neighborhood neighborhood_name\nfrom __dbt__CTE__station_json inner join __dbt__CTE__nhood_json\nwhere st_within(station_geo, geo)\n),  __dbt__CTE__region_json as (\n\n\n--\n-- get the region data in JSON format\n--\n\nwith r as (\n  select payload, row_inserted from citibike.dbt_aeldridge.gbfs_json\n      where data = 'regions'\n      and row_inserted = (select max(row_inserted) from citibike.dbt_aeldridge.gbfs_json))\nselect value region_v,\n         payload:response.last_updated::timestamp last_updated,\n         row_inserted\nfrom r, lateral flatten (input => payload:response.data.regions)\n),s as (\n    select * from __dbt__CTE__station_nhood_json\n      where row_inserted = (select max(row_inserted) from __dbt__CTE__station_json)),\nr as (\n    select * from __dbt__CTE__region_json\n      where row_inserted = (select max(row_inserted) from __dbt__CTE__region_json))\nselect station_v:station_id::number station_id,\n    station_v:name::string station_name,\n    station_v:lat::float station_lat,\n    station_v:lon::float station_lon,\n    station_geo,\n    station_v:station_type::string station_type,\n    station_v:capacity::number station_capacity,\n    station_v:rental_methods rental_methods,\n    region_v:name::string region_name,\n    borough_name, neighborhood_name\nfrom s left outer join r\n    on station_v:region_id::integer = region_v:region_id::integer"}, "error": null, "status": "SUCCESS 1", "execution_time": 6.00509786605835, "thread_id": "Thread-1", "timing": [{"name": "compile", "started_at": "2020-10-20T03:27:51.422119Z", "completed_at": "2020-10-20T03:27:51.459226Z"}, {"name": "execute", "started_at": "2020-10-20T03:27:51.459511Z", "completed_at": "2020-10-20T03:27:56.959081Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{{ config(materialized='view') }}\n\n--\n-- trip data enhanced with station location data\n--\n\nselect *\nfrom {{ source('demo', 'trips') }} t\n     left outer join {{ ref('ss') }} ss  on t.start_station_id = ss.start_stn_id\n     left outer join {{ ref('es') }} es  on t.end_station_id = es.end_stn_id", "compiled": true, "database": "citibike", "schema": "dbt_aeldridge", "fqn": ["citibike", "mart", "trips_stations_vw"], "unique_id": "model.citibike.trips_stations_vw", "package_name": "citibike", "root_path": "/usr/src/develop/user-10267/environment-12627/repository-10327", "path": "mart/trips_stations_vw.sql", "original_file_path": "models/mart/trips_stations_vw.sql", "name": "trips_stations_vw", "resource_type": "model", "alias": "trips_stations_vw", "checksum": {"name": "sha256", "checksum": "d59d09ddffd8f39f191b2396704bb5ce3194069f75a0224b93749452d0718a90"}, "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "alias": null, "schema": null, "database": "citibike", "tags": [], "full_refresh": null}, "tags": [], "refs": [["ss"], ["es"]], "sources": [["demo", "trips"]], "depends_on": {"macros": ["macro.dbt_snowflake.set_query_tag", "macro.dbt.create_or_replace_view", "macro.dbt.persist_docs"], "nodes": ["source.citibike.demo.trips", "model.citibike.ss", "model.citibike.es"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/run/citibike/models/mart/trips_stations_vw.sql", "deferred": false, "compiled_sql": "\n\n--\n-- trip data enhanced with station location data\n--\n\nselect *\nfrom citibike.demo.trips t\n     left outer join __dbt__CTE__ss ss  on t.start_station_id = ss.start_stn_id\n     left outer join __dbt__CTE__es es  on t.end_station_id = es.end_stn_id", "extra_ctes_injected": true, "extra_ctes": [{"id": "model.citibike.ss", "sql": " __dbt__CTE__ss as (\n\n\nselect station_id start_stn_id,\n    station_name start_station, region_name start_region,\n    borough_name start_borough, neighborhood_name start_neighborhood,\n    station_lat start_lat, station_lon start_lon, station_geo start_geo\nfrom citibike.dbt_aeldridge.stations\n)"}, {"id": "model.citibike.es", "sql": " __dbt__CTE__es as (\n\n\nselect station_id end_stn_id,\n    station_name end_station, region_name end_region,\n    borough_name end_borough, neighborhood_name end_neighborhood,\n    station_lat end_lat, station_lon end_lon, station_geo end_geo\nfrom citibike.dbt_aeldridge.stations\n)"}], "injected_sql": "\n\nwith __dbt__CTE__ss as (\n\n\nselect station_id start_stn_id,\n    station_name start_station, region_name start_region,\n    borough_name start_borough, neighborhood_name start_neighborhood,\n    station_lat start_lat, station_lon start_lon, station_geo start_geo\nfrom citibike.dbt_aeldridge.stations\n),  __dbt__CTE__es as (\n\n\nselect station_id end_stn_id,\n    station_name end_station, region_name end_region,\n    borough_name end_borough, neighborhood_name end_neighborhood,\n    station_lat end_lat, station_lon end_lon, station_geo end_geo\nfrom citibike.dbt_aeldridge.stations\n)--\n-- trip data enhanced with station location data\n--\n\nselect *\nfrom citibike.demo.trips t\n     left outer join __dbt__CTE__ss ss  on t.start_station_id = ss.start_stn_id\n     left outer join __dbt__CTE__es es  on t.end_station_id = es.end_stn_id"}, "error": null, "status": "SUCCESS 1", "execution_time": 2.853632688522339, "thread_id": "Thread-1", "timing": [{"name": "compile", "started_at": "2020-10-20T03:27:57.472525Z", "completed_at": "2020-10-20T03:27:57.496993Z"}, {"name": "execute", "started_at": "2020-10-20T03:27:57.497265Z", "completed_at": "2020-10-20T03:27:59.860521Z"}], "fail": null, "warn": null, "skip": false}, {"node": {"raw_sql": "{{ config(materialized='view') }}\n\n--\n-- connecting the trip and the weather data together\n--\n\nselect *\nfrom {{ ref('trips_stations_vw') }} \n    left outer join {{ ref('weather_vw') }} on date_trunc('hour', starttime) = observation_time\nwhere city_id = 5128638", "compiled": true, "database": "citibike", "schema": "dbt_aeldridge", "fqn": ["citibike", "mart", "trips_stations_weather_vw"], "unique_id": "model.citibike.trips_stations_weather_vw", "package_name": "citibike", "root_path": "/usr/src/develop/user-10267/environment-12627/repository-10327", "path": "mart/trips_stations_weather_vw.sql", "original_file_path": "models/mart/trips_stations_weather_vw.sql", "name": "trips_stations_weather_vw", "resource_type": "model", "alias": "trips_stations_weather_vw", "checksum": {"name": "sha256", "checksum": "813a05a5324e374c6142acabec7978872f068fb3606532341c0273aecaab6d00"}, "config": {"enabled": true, "materialized": "view", "persist_docs": {}, "post-hook": [], "pre-hook": [], "vars": {}, "quoting": {}, "column_types": {}, "alias": null, "schema": null, "database": "citibike", "tags": [], "full_refresh": null}, "tags": [], "refs": [["trips_stations_vw"], ["weather_vw"]], "sources": [], "depends_on": {"macros": ["macro.dbt_snowflake.set_query_tag", "macro.dbt.create_or_replace_view", "macro.dbt.persist_docs"], "nodes": ["model.citibike.trips_stations_vw", "model.citibike.weather_vw"]}, "description": "", "columns": {}, "meta": {}, "docs": {"show": true}, "patch_path": null, "build_path": "target/run/citibike/models/mart/trips_stations_weather_vw.sql", "deferred": false, "compiled_sql": "\n\n--\n-- connecting the trip and the weather data together\n--\n\nselect *\nfrom citibike.dbt_aeldridge.trips_stations_vw \n    left outer join __dbt__CTE__weather_vw on date_trunc('hour', starttime) = observation_time\nwhere city_id = 5128638", "extra_ctes_injected": true, "extra_ctes": [{"id": "model.citibike.weather_vw", "sql": " __dbt__CTE__weather_vw as (\n\n\n--\n-- extracting/calculating the attributes from the weather JSON\n--\n\nselect v:city.id::int                              city_id\n    ,date_trunc('hour', t)                         observation_time\n    ,utils.degKtoC(avg(v:main.temp::float))        temp_avg_c\n    ,utils.degKtoF(avg(v:main.temp::float))        temp_avg_f\n    ,truncate(avg(v:wind.deg::float))              wind_dir\n    ,truncate(avg(v:wind.speed::float), 1)         wind_speed_mph\n    ,truncate(avg(v:wind.speed::float) * 1.61, 1)  wind_speed_kph\nfrom citibike.demo.weather\ngroup by 1, 2\n)"}], "injected_sql": "\n\nwith __dbt__CTE__weather_vw as (\n\n\n--\n-- extracting/calculating the attributes from the weather JSON\n--\n\nselect v:city.id::int                              city_id\n    ,date_trunc('hour', t)                         observation_time\n    ,utils.degKtoC(avg(v:main.temp::float))        temp_avg_c\n    ,utils.degKtoF(avg(v:main.temp::float))        temp_avg_f\n    ,truncate(avg(v:wind.deg::float))              wind_dir\n    ,truncate(avg(v:wind.speed::float), 1)         wind_speed_mph\n    ,truncate(avg(v:wind.speed::float) * 1.61, 1)  wind_speed_kph\nfrom citibike.demo.weather\ngroup by 1, 2\n)--\n-- connecting the trip and the weather data together\n--\n\nselect *\nfrom citibike.dbt_aeldridge.trips_stations_vw \n    left outer join __dbt__CTE__weather_vw on date_trunc('hour', starttime) = observation_time\nwhere city_id = 5128638"}, "error": null, "status": "SUCCESS 1", "execution_time": 2.9231815338134766, "thread_id": "Thread-1", "timing": [{"name": "compile", "started_at": "2020-10-20T03:28:00.329846Z", "completed_at": "2020-10-20T03:28:00.354206Z"}, {"name": "execute", "started_at": "2020-10-20T03:28:00.354490Z", "completed_at": "2020-10-20T03:28:02.765997Z"}], "fail": null, "warn": null, "skip": false}], "generated_at": "2020-10-20T03:28:05.486939Z", "elapsed_time": 34.94160866737366}